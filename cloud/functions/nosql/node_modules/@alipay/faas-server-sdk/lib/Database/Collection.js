"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Collection=void 0;const faas_db_builder_1=require("@alipay/faas-db-builder"),faas_server_utils_1=require("@alipay/faas-server-utils"),faas_common_sdk_1=require("@alipay/faas-common-sdk");class Collection{#e;#s;#a;#i;#t;constructor(t,e,s){this.#e=t,this.#s=e,this.#i=s,this.#a=new faas_db_builder_1.CollectionBuilder(e),this.#t=new faas_common_sdk_1.Collection(e,{httpclient:s,type:"function",databaseName:t.functionDatabaseName,throwOnNotFound:t.throwOnNotFound})}async add(t){if(Array.isArray(t.data))return this.#o(t);const e=(0,faas_server_utils_1.getAlipayContext)(),{data:s}=t,i={...s,_openid:s._openid||e.OPENID};return this.#t.add({data:i})}async#o(t){const{options:e}=this.#a.add(t),s="POST",i=`${this.#r()}?batchCreate`,o=(0,faas_server_utils_1.getAlipayContext)();e.$create.forEach(a=>{a._openid=a._openid||o.OPENID});const r=await this.#i.request({method:s,path:i,data:e});return{_ids:faas_common_sdk_1.ResponseUtil.handleResponse(r).insertedIds.map(({_id:a})=>a)}}doc(t){return this.#t.doc(t)}limit(t){return this.#t.limit(t)}skip(t){return this.#t.skip(t)}where(t){return this.#t.where(t)}projection(t){return this.#t.projection(t)}field(t){return this.projection(t)}orderBy(t,e){return this.#t.orderBy(t,e)}aggregate(){return this.#t.aggregate()}async get(){return await this.#t.get()}async count(){return await this.#t.count()}#r(){return`/${this.#e.functionDatabaseName||"faas"}/${this.#s}`}}exports.Collection=Collection;
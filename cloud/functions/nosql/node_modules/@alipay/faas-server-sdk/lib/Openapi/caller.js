"use strict";var __importDefault=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OpenapiCaller=void 0;const faas_common_sdk_1=require("@alipay/faas-common-sdk"),snakecase_keys_1=__importDefault(require("snakecase-keys")),errors_1=require("../errors"),requester_1=require("../requester");class OpenapiCaller{#t;#e;constructor(s,n){this.#t=n,this.#e=requester_1.Httpclient.createOpenapiHttpclient(s)}async requestRaw(s,n,a,o){const{res:e}=await this.#e.requestRaw({method:s,path:n,data:a,headers:o});return e}async request(s,n){const a="POST",o="/functions/invokeOpenapi",e=(0,snakecase_keys_1.default)(Object.assign({},n),{deep:!0});e.biz_content&&typeof e.biz_content!="string"&&(e.biz_content=JSON.stringify(e.biz_content));const c={"x-openapi":s,"x-openapi-version":this.#t},t=await this.#e.request({method:a,path:o,data:e,headers:c});if(t.status!==200){const{code:u,message:_,errCode:l,errMsg:d}=t.data;throw faas_common_sdk_1.FaasError.SERVER_ERR(u||l,_||d,t.requestID,t.status)}const p=`${s.replace(/\./g,"_")}_response`,i=t.data?.[p];if(!i)throw errors_1.errors.INVALID_OPENAPI_RESPONSE_ERR(t.requestID,t.data||"");return i}}exports.OpenapiCaller=OpenapiCaller;
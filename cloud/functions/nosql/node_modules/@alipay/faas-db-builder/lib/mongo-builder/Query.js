"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++){t=arguments[i];for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]}return e};return __assign.apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:true});exports.QueryBuilder=void 0;var QueryRequest_1=require("../command/QueryRequest");var UpdateRequest_1=require("../command/UpdateRequest");var constant_1=require("../common/constant");var util_1=require("../common/util");var QueryBuilder=function(){function e(t){this.collectionName=t;this.criteria={sort:[]}}e.prototype.limit=function(t){this.criteria.limit=t;return this};e.prototype.skip=function(t){this.criteria.skip=t;return this};e.prototype.where=function(t){this.criteria.match=t;return this};e.prototype.projection=function(t){for(var i in t){if(t[i]){if(typeof t[i]!=="object"){t[i]=1}}else{t[i]=0}}this.criteria.projection=t;return this};e.prototype.orderBy=function(t,i){this.criteria.sort.push({field:t,sort:i});return this};e.prototype.update=function(t){return this.build(constant_1.DocumentAction.update,__assign(__assign({},this.baseOptions()),{$update:new UpdateRequest_1.UpdateRequest(t.data).toJSON()}))};e.prototype.set=function(t){return this.build(constant_1.DocumentAction.replace,__assign(__assign({},this.baseOptions()),{$replace:t.data}))};e.prototype.remove=function(){return this.build(constant_1.DocumentAction.delete,this.baseOptions())};e.prototype.get=function(){return this.build(constant_1.DocumentAction.queryList,__assign({$limit:100},this.findOptions()))};e.prototype.count=function(){return this.build(constant_1.DocumentAction.count,this.baseOptions())};e.prototype.baseOptions=function(){var t={};if(typeof this.criteria.match!=="undefined"){var i=new QueryRequest_1.QueryRequest(this.criteria.match);t.$match=i.toJSON()}if(typeof this.criteria.limit!=="undefined"){t.$limit=this.criteria.limit}return t};e.prototype.findOptions=function(){var t=this.baseOptions();if(typeof this.criteria.projection!=="undefined"){t.$project=this.criteria.projection}if(typeof this.criteria.sort!=="undefined"){t.$sort={};for(var i=0,o=this.criteria.sort;i<o.length;i++){var r=o[i];t.$sort[r.field]=r.sort===constant_1.Sort.DESC?-1:1}}if(typeof this.criteria.skip!=="undefined"){t.$skip=this.criteria.skip}return t};e.prototype.build=function(t,i){return util_1.ActionBuilder.buildDocumentAction(t,this.collectionName,i)};return e}();exports.QueryBuilder=QueryBuilder;
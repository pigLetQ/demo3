"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AggregatePipeline=void 0;var AggregateRequest_1=require("./AggregateRequest");var QueryRequest_1=require("./QueryRequest");var constant_1=require("../common/constant");var error_1=require("../common/error");var AggregatePipeline=function(){function t(){this.pipeline=[]}t.prototype.match=function(e){this.pushStage(constant_1.PipelineStageName.match,e);return this};t.prototype.group=function(e){this.pushStage(constant_1.PipelineStageName.group,e);return this};t.prototype.sample=function(e){this.pushStage(constant_1.PipelineStageName.sample,e);return this};t.prototype.lookup=function(e){this.pushStage(constant_1.PipelineStageName.lookup,e);return this};t.prototype.done=function(){return this.pipeline.map(function(e){var r;switch(e.name){case constant_1.PipelineStageName.match:return{$match:new QueryRequest_1.QueryRequest(e.param).toJSON()};case constant_1.PipelineStageName.sample:case constant_1.PipelineStageName.lookup:return r={},r[e.name]=e.param,r;case constant_1.PipelineStageName.group:return{$group:new AggregateRequest_1.AggregateRequest(e.param).toJSON()};default:{var a=e.name;throw error_1.DbBuildError.invalidParam(a,"\u4E0D\u652F\u6301\u7684 aggregate \u64CD\u4F5C")}}})};t.prototype.pushStage=function(e,r){this.pipeline.push({name:e,param:r})};return t}();exports.AggregatePipeline=AggregatePipeline;
"use strict";var __decorate=this&&this.__decorate||function(o,n,e,s){var i=arguments.length,t=i<3?n:s===null?s=Object.getOwnPropertyDescriptor(n,e):s,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")t=Reflect.decorate(o,n,e,s);else for(var c=o.length-1;c>=0;c--)if(a=o[c])t=(i<3?a(t):i>3?a(n,e,t):a(n,e))||t;return i>3&&t&&Object.defineProperty(n,e,t),t};var __metadata=this&&this.__metadata||function(o,n){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(o,n)};var __awaiter=this&&this.__awaiter||function(o,n,e,s){function i(t){return t instanceof e?t:new e(function(a){a(t)})}return new(e||(e=Promise))(function(t,a){function c(u){try{r(s.next(u))}catch(p){a(p)}}function l(u){try{r(s["throw"](u))}catch(p){a(p)}}function r(u){u.done?t(u.value):i(u.value).then(c,l)}r((s=s.apply(o,n||[])).next())})};var __generator=this&&this.__generator||function(o,n){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},s,i,t,a;return a={next:c(0),"throw":c(1),"return":c(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(r){return function(u){return l([r,u])}}function l(r){if(s)throw new TypeError("Generator is already executing.");while(a&&(a=0,r[0]&&(e=0)),e)try{if(s=1,i&&(t=r[0]&2?i["return"]:r[0]?i["throw"]||((t=i["return"])&&t.call(i),0):i.next)&&!(t=t.call(i,r[1])).done)return t;if(i=0,t)r=[r[0]&2,t.value];switch(r[0]){case 0:case 1:t=r;break;case 4:e.label++;return{value:r[1],done:false};case 5:e.label++;i=r[1];r=[0];continue;case 7:r=e.ops.pop();e.trys.pop();continue;default:if(!(t=e.trys,t=t.length>0&&t[t.length-1])&&(r[0]===6||r[0]===2)){e=0;continue}if(r[0]===3&&(!t||r[1]>t[0]&&r[1]<t[3])){e.label=r[1];break}if(r[0]===6&&e.label<t[1]){e.label=t[1];t=r;break}if(t&&e.label<t[2]){e.label=t[2];e.ops.push(r);break}if(t[2])e.ops.pop();e.trys.pop();continue}r=n.call(o,e)}catch(u){r=[6,u];i=0}finally{s=t=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.Query=void 0;var faas_db_builder_1=require("@alipay/faas-db-builder");var decorator_1=require("../decorator");var utils_1=require("../utils");var Query=exports.Query=function(){function o(n,e){this.collectionName=n;this.options=e;this.builder=new faas_db_builder_1.QueryBuilder(n)}o.prototype.limit=function(n){this.builder.limit(n);return this};o.prototype.skip=function(n){this.builder.skip(n);return this};o.prototype.where=function(n){this.builder.where(n);return this};o.prototype.projection=function(n){this.builder.projection(n);return this};o.prototype.field=function(n){this.builder.projection(n);return this};o.prototype.orderBy=function(n,e){this.builder.orderBy(n,e);return this};o.prototype.update=function(n){return __awaiter(this,void 0,void 0,function(){var e,s,i,t;return __generator(this,function(a){switch(a.label){case 0:e="POST";s="".concat(this.getCollectionPath(),"?update");i=this.builder.update(n).options;return[4,this.options.httpclient.request({method:e,path:s,data:i})];case 1:t=a.sent();return[2,utils_1.ResponseUtil.handleResponse(t)]}})})};o.prototype.set=function(n){return __awaiter(this,void 0,void 0,function(){var e,s,i,t;return __generator(this,function(a){switch(a.label){case 0:e="POST";s="".concat(this.getCollectionPath(),"?replace");i=this.builder.set(n).options;return[4,this.options.httpclient.request({method:e,path:s,data:i})];case 1:t=a.sent();return[2,utils_1.ResponseUtil.handleResponse(t)]}})})};o.prototype.remove=function(){return __awaiter(this,void 0,void 0,function(){var n,e,s,i;return __generator(this,function(t){switch(t.label){case 0:n="POST";e="".concat(this.getCollectionPath(),"?delete");s=this.builder.remove().options;return[4,this.options.httpclient.request({method:n,path:e,data:s})];case 1:i=t.sent();return[2,utils_1.ResponseUtil.handleResponse(i)]}})})};o.prototype.get=function(){return __awaiter(this,void 0,void 0,function(){var n,e,s,i;return __generator(this,function(t){switch(t.label){case 0:n="POST";e="".concat(this.getCollectionPath(),"?query");s=this.builder.get().options;return[4,this.options.httpclient.request({method:n,path:e,data:s})];case 1:i=t.sent();return[2,utils_1.ResponseUtil.handleResponse(i)]}})})};o.prototype.count=function(){return __awaiter(this,void 0,void 0,function(){var n,e,s,i,t;return __generator(this,function(a){switch(a.label){case 0:n="POST";e="".concat(this.getCollectionPath(),"?count");s=this.builder.count().options;return[4,this.options.httpclient.request({method:n,path:e,data:s})];case 1:i=a.sent();t=utils_1.ResponseUtil.handleResponse(i);return[2,{total:t.count}]}})})};o.prototype.getCollectionPath=function(){return"/".concat(this.options.databaseName||"faas","/").concat(this.collectionName)};__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],o.prototype,"update",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],o.prototype,"set",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],o.prototype,"remove",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],o.prototype,"get",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],o.prototype,"count",null);return o}();
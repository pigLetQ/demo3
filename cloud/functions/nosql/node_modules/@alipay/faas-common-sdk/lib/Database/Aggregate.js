"use strict";var __decorate=this&&this.__decorate||function(a,r,e,o){var i=arguments.length,t=i<3?r:o===null?o=Object.getOwnPropertyDescriptor(r,e):o,u;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")t=Reflect.decorate(a,r,e,o);else for(var l=a.length-1;l>=0;l--)if(u=a[l])t=(i<3?u(t):i>3?u(r,e,t):u(r,e))||t;return i>3&&t&&Object.defineProperty(r,e,t),t};var __metadata=this&&this.__metadata||function(a,r){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(a,r)};var __awaiter=this&&this.__awaiter||function(a,r,e,o){function i(t){return t instanceof e?t:new e(function(u){u(t)})}return new(e||(e=Promise))(function(t,u){function l(c){try{n(o.next(c))}catch(f){u(f)}}function s(c){try{n(o["throw"](c))}catch(f){u(f)}}function n(c){c.done?t(c.value):i(c.value).then(l,s)}n((o=o.apply(a,r||[])).next())})};var __generator=this&&this.__generator||function(a,r){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,i,t,u;return u={next:l(0),"throw":l(1),"return":l(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(n){return function(c){return s([n,c])}}function s(n){if(o)throw new TypeError("Generator is already executing.");while(u&&(u=0,n[0]&&(e=0)),e)try{if(o=1,i&&(t=n[0]&2?i["return"]:n[0]?i["throw"]||((t=i["return"])&&t.call(i),0):i.next)&&!(t=t.call(i,n[1])).done)return t;if(i=0,t)n=[n[0]&2,t.value];switch(n[0]){case 0:case 1:t=n;break;case 4:e.label++;return{value:n[1],done:false};case 5:e.label++;i=n[1];n=[0];continue;case 7:n=e.ops.pop();e.trys.pop();continue;default:if(!(t=e.trys,t=t.length>0&&t[t.length-1])&&(n[0]===6||n[0]===2)){e=0;continue}if(n[0]===3&&(!t||n[1]>t[0]&&n[1]<t[3])){e.label=n[1];break}if(n[0]===6&&e.label<t[1]){e.label=t[1];t=n;break}if(t&&e.label<t[2]){e.label=t[2];e.ops.push(n);break}if(t[2])e.ops.pop();e.trys.pop();continue}n=r.call(a,e)}catch(c){n=[6,c];i=0}finally{o=t=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.Aggregate=void 0;var faas_db_builder_1=require("@alipay/faas-db-builder");var decorator_1=require("../decorator");var utils_1=require("../utils");var Aggregate=exports.Aggregate=function(){function a(r,e){this.collectionName=r;this.options=e;this.builder=new faas_db_builder_1.AggregateBuilder(r)}a.prototype.match=function(r){this.builder.match(r);return this};a.prototype.group=function(r){this.builder.group(r);return this};a.prototype.sample=function(r){this.builder.sample(r);return this};a.prototype.lookup=function(r){this.builder.lookup(r);return this};a.prototype.end=function(){return __awaiter(this,void 0,void 0,function(){var r,e,o,i;return __generator(this,function(t){switch(t.label){case 0:r=this.builder.end().options;e="POST";o="".concat(this.getCollectionPath(),"?aggregate");return[4,this.options.httpclient.request({method:e,path:o,data:r})];case 1:i=t.sent();return[2,utils_1.ResponseUtil.handleResponse(i)]}})})};a.prototype.getCollectionPath=function(){return"/".concat(this.options.databaseName||"faas","/").concat(this.collectionName)};__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],a.prototype,"end",null);return a}();
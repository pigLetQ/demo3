"use strict";var __decorate=this&&this.__decorate||function(i,e,n,u){var o=arguments.length,t=o<3?e:u===null?u=Object.getOwnPropertyDescriptor(e,n):u,c;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")t=Reflect.decorate(i,e,n,u);else for(var s=i.length-1;s>=0;s--)if(c=i[s])t=(o<3?c(t):o>3?c(e,n,t):c(e,n))||t;return o>3&&t&&Object.defineProperty(e,n,t),t};var __metadata=this&&this.__metadata||function(i,e){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(i,e)};var __awaiter=this&&this.__awaiter||function(i,e,n,u){function o(t){return t instanceof n?t:new n(function(c){c(t)})}return new(n||(n=Promise))(function(t,c){function s(a){try{r(u.next(a))}catch(f){c(f)}}function l(a){try{r(u["throw"](a))}catch(f){c(f)}}function r(a){a.done?t(a.value):o(a.value).then(s,l)}r((u=u.apply(i,e||[])).next())})};var __generator=this&&this.__generator||function(i,e){var n={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},u,o,t,c;return c={next:s(0),"throw":s(1),"return":s(2)},typeof Symbol==="function"&&(c[Symbol.iterator]=function(){return this}),c;function s(r){return function(a){return l([r,a])}}function l(r){if(u)throw new TypeError("Generator is already executing.");while(c&&(c=0,r[0]&&(n=0)),n)try{if(u=1,o&&(t=r[0]&2?o["return"]:r[0]?o["throw"]||((t=o["return"])&&t.call(o),0):o.next)&&!(t=t.call(o,r[1])).done)return t;if(o=0,t)r=[r[0]&2,t.value];switch(r[0]){case 0:case 1:t=r;break;case 4:n.label++;return{value:r[1],done:false};case 5:n.label++;o=r[1];r=[0];continue;case 7:r=n.ops.pop();n.trys.pop();continue;default:if(!(t=n.trys,t=t.length>0&&t[t.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!t||r[1]>t[0]&&r[1]<t[3])){n.label=r[1];break}if(r[0]===6&&n.label<t[1]){n.label=t[1];t=r;break}if(t&&n.label<t[2]){n.label=t[2];n.ops.push(r);break}if(t[2])n.ops.pop();n.trys.pop();continue}r=e.call(i,n)}catch(a){r=[6,a];o=0}finally{u=t=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.Collection=void 0;var faas_db_builder_1=require("@alipay/faas-db-builder");var decorator_1=require("../decorator");var utils_1=require("../utils");var Aggregate_1=require("./Aggregate");var Document_1=require("./Document");var Query_1=require("./Query");var Collection=exports.Collection=function(){function i(e,n){this.collectionName=e;this.options=n;this.builder=new faas_db_builder_1.CollectionBuilder(e)}i.prototype.add=function(e){return __awaiter(this,void 0,void 0,function(){var n,u,o,t;return __generator(this,function(c){switch(c.label){case 0:n=this.builder.add(e).options;u="POST";o=this.getDocumentPath(e.data._id);return[4,this.options.httpclient.request({method:u,path:o,data:n})];case 1:t=c.sent();return[2,utils_1.ResponseUtil.handleResponse(t)]}})})};i.prototype.doc=function(e){return new Document_1.Document(this.collectionName,e,this.options)};i.prototype.limit=function(e){return new Query_1.Query(this.collectionName,this.options).limit(e)};i.prototype.skip=function(e){return new Query_1.Query(this.collectionName,this.options).skip(e)};i.prototype.where=function(e){return new Query_1.Query(this.collectionName,this.options).where(e)};i.prototype.projection=function(e){return new Query_1.Query(this.collectionName,this.options).projection(e)};i.prototype.field=function(e){return new Query_1.Query(this.collectionName,this.options).field(e)};i.prototype.orderBy=function(e,n){return new Query_1.Query(this.collectionName,this.options).orderBy(e,n)};i.prototype.aggregate=function(){return new Aggregate_1.Aggregate(this.collectionName,this.options)};i.prototype.get=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,new Query_1.Query(this.collectionName,this.options).get()];case 1:return[2,e.sent()]}})})};i.prototype.count=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,new Query_1.Query(this.collectionName,this.options).count()];case 1:return[2,e.sent()]}})})};i.prototype.getDocumentPath=function(e){return"/".concat(this.options.databaseName||"faas","/").concat(this.collectionName,"?_id=").concat(e||"")};__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],i.prototype,"add",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],i.prototype,"get",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],i.prototype,"count",null);return i}();
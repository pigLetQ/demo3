var h=function(s,n,e,o){var i=arguments.length,t=i<3?n:o===null?o=Object.getOwnPropertyDescriptor(n,e):o,u;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")t=Reflect.decorate(s,n,e,o);else for(var c=s.length-1;c>=0;c--)if(u=s[c])t=(i<3?u(t):i>3?u(n,e,t):u(n,e))||t;return i>3&&t&&Object.defineProperty(n,e,t),t};var a=function(s,n){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(s,n)};var l=function(s,n,e,o){function i(t){return t instanceof e?t:new e(function(u){u(t)})}return new(e||(e=Promise))(function(t,u){function c(p){try{r(o.next(p))}catch(b){u(b)}}function m(p){try{r(o["throw"](p))}catch(b){u(b)}}function r(p){p.done?t(p.value):i(p.value).then(c,m)}r((o=o.apply(s,n||[])).next())})};var d=function(s,n){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,i,t,u;return u={next:c(0),"throw":c(1),"return":c(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(r){return function(p){return m([r,p])}}function m(r){if(o)throw new TypeError("Generator is already executing.");while(u&&(u=0,r[0]&&(e=0)),e)try{if(o=1,i&&(t=r[0]&2?i["return"]:r[0]?i["throw"]||((t=i["return"])&&t.call(i),0):i.next)&&!(t=t.call(i,r[1])).done)return t;if(i=0,t)r=[r[0]&2,t.value];switch(r[0]){case 0:case 1:t=r;break;case 4:e.label++;return{value:r[1],done:false};case 5:e.label++;i=r[1];r=[0];continue;case 7:r=e.ops.pop();e.trys.pop();continue;default:if(!(t=e.trys,t=t.length>0&&t[t.length-1])&&(r[0]===6||r[0]===2)){e=0;continue}if(r[0]===3&&(!t||r[1]>t[0]&&r[1]<t[3])){e.label=r[1];break}if(r[0]===6&&e.label<t[1]){e.label=t[1];t=r;break}if(t&&e.label<t[2]){e.label=t[2];e.ops.push(r);break}if(t[2])e.ops.pop();e.trys.pop();continue}r=n.call(s,e)}catch(p){r=[6,p];i=0}finally{o=t=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:true}}};import{QueryBuilder as v}from"@alipay/faas-db-builder";import{WrapCallback as f}from"../decorator";import{ResponseUtil as y}from"../utils";var g=function(){function s(n,e){this.collectionName=n;this.options=e;this.builder=new v(n)}s.prototype.limit=function(n){this.builder.limit(n);return this};s.prototype.skip=function(n){this.builder.skip(n);return this};s.prototype.where=function(n){this.builder.where(n);return this};s.prototype.projection=function(n){this.builder.projection(n);return this};s.prototype.field=function(n){this.builder.projection(n);return this};s.prototype.orderBy=function(n,e){this.builder.orderBy(n,e);return this};s.prototype.updateAndReturn=function(n){return l(this,void 0,void 0,function(){var e,o,i,t,u;return d(this,function(c){switch(c.label){case 0:e="POST";o="".concat(this.getCollectionPath(),"?findOneAndUpdate");i=this.builder.updateAndReturn(n).options;return[4,this.options.httpclient.request({method:e,path:o,data:i})];case 1:t=c.sent();u=y.handleResponse(t);return[2,{updated:u?1:0,doc:u}]}})})};s.prototype.update=function(n){return l(this,void 0,void 0,function(){var e,o,i,t;return d(this,function(u){switch(u.label){case 0:e="POST";o="".concat(this.getCollectionPath(),"?update");i=this.builder.update(n).options;return[4,this.options.httpclient.request({method:e,path:o,data:i})];case 1:t=u.sent();return[2,y.handleResponse(t)]}})})};s.prototype.set=function(n){return l(this,void 0,void 0,function(){var e,o,i,t;return d(this,function(u){switch(u.label){case 0:e="POST";o="".concat(this.getCollectionPath(),"?replace");i=this.builder.set(n).options;return[4,this.options.httpclient.request({method:e,path:o,data:i})];case 1:t=u.sent();return[2,y.handleResponse(t)]}})})};s.prototype.remove=function(){return l(this,void 0,void 0,function(){var n,e,o,i;return d(this,function(t){switch(t.label){case 0:n="POST";e="".concat(this.getCollectionPath(),"?delete");o=this.builder.remove().options;return[4,this.options.httpclient.request({method:n,path:e,data:o})];case 1:i=t.sent();return[2,y.handleResponse(i)]}})})};s.prototype.get=function(){return l(this,void 0,void 0,function(){var n,e,o,i;return d(this,function(t){switch(t.label){case 0:n="POST";e="".concat(this.getCollectionPath(),"?query");o=this.builder.get().options;return[4,this.options.httpclient.request({method:n,path:e,data:o})];case 1:i=t.sent();return[2,y.handleResponse(i)]}})})};s.prototype.count=function(){return l(this,void 0,void 0,function(){var n,e,o,i,t;return d(this,function(u){switch(u.label){case 0:n="POST";e="".concat(this.getCollectionPath(),"?count");o=this.builder.count().options;return[4,this.options.httpclient.request({method:n,path:e,data:o})];case 1:i=u.sent();t=y.handleResponse(i);return[2,{total:t.count}]}})})};s.prototype.getCollectionPath=function(){return"/".concat(this.options.databaseName||"faas","/").concat(this.collectionName)};h([f(),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],s.prototype,"updateAndReturn",null);h([f(),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],s.prototype,"update",null);h([f(),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],s.prototype,"set",null);h([f(),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],s.prototype,"remove",null);h([f(),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],s.prototype,"get",null);h([f(),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],s.prototype,"count",null);return s}();export{g as Query};
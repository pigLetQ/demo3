var p=function(i,e,n,u){var o=arguments.length,t=o<3?e:u===null?u=Object.getOwnPropertyDescriptor(e,n):u,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")t=Reflect.decorate(i,e,n,u);else for(var s=i.length-1;s>=0;s--)if(a=i[s])t=(o<3?a(t):o>3?a(e,n,t):a(e,n))||t;return o>3&&t&&Object.defineProperty(e,n,t),t};var h=function(i,e){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(i,e)};var d=function(i,e,n,u){function o(t){return t instanceof n?t:new n(function(a){a(t)})}return new(n||(n=Promise))(function(t,a){function s(c){try{r(u.next(c))}catch(f){a(f)}}function l(c){try{r(u["throw"](c))}catch(f){a(f)}}function r(c){c.done?t(c.value):o(c.value).then(s,l)}r((u=u.apply(i,e||[])).next())})};var b=function(i,e){var n={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},u,o,t,a;return a={next:s(0),"throw":s(1),"return":s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(r){return function(c){return l([r,c])}}function l(r){if(u)throw new TypeError("Generator is already executing.");while(a&&(a=0,r[0]&&(n=0)),n)try{if(u=1,o&&(t=r[0]&2?o["return"]:r[0]?o["throw"]||((t=o["return"])&&t.call(o),0):o.next)&&!(t=t.call(o,r[1])).done)return t;if(o=0,t)r=[r[0]&2,t.value];switch(r[0]){case 0:case 1:t=r;break;case 4:n.label++;return{value:r[1],done:false};case 5:n.label++;o=r[1];r=[0];continue;case 7:r=n.ops.pop();n.trys.pop();continue;default:if(!(t=n.trys,t=t.length>0&&t[t.length-1])&&(r[0]===6||r[0]===2)){n=0;continue}if(r[0]===3&&(!t||r[1]>t[0]&&r[1]<t[3])){n.label=r[1];break}if(r[0]===6&&n.label<t[1]){n.label=t[1];t=r;break}if(t&&n.label<t[2]){n.label=t[2];n.ops.push(r);break}if(t[2])n.ops.pop();n.trys.pop();continue}r=e.call(i,n)}catch(c){r=[6,c];o=0}finally{u=t=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:true}}};import{AggregateBuilder as y}from"@alipay/faas-db-builder";import{WrapCallback as m}from"../decorator";import{ResponseUtil as g}from"../utils";var w=function(){function i(e,n){this.collectionName=e;this.options=n;this.builder=new y(e)}i.prototype.addFields=function(e){this.builder.addFields(e);return this};i.prototype.count=function(e){this.builder.count(e);return this};i.prototype.match=function(e){this.builder.match(e);return this};i.prototype.group=function(e){this.builder.group(e);return this};i.prototype.sample=function(e){this.builder.sample(e);return this};i.prototype.lookup=function(e){this.builder.lookup(e);return this};i.prototype.project=function(e){this.builder.project(e);return this};i.prototype.replaceRoot=function(e){this.builder.replaceRoot(e);return this};i.prototype.sort=function(e){this.builder.sort(e);return this};i.prototype.limit=function(e){this.builder.limit(e);return this};i.prototype.skip=function(e){this.builder.skip(e);return this};i.prototype.unwind=function(e){this.builder.unwind(e);return this};i.prototype.end=function(){return d(this,void 0,void 0,function(){var e,n,u,o;return b(this,function(t){switch(t.label){case 0:e=this.builder.end().options;n="POST";u="".concat(this.getCollectionPath(),"?aggregate");return[4,this.options.httpclient.request({method:n,path:u,data:e})];case 1:o=t.sent();return[2,g.handleResponse(o)]}})})};i.prototype.getCollectionPath=function(){return"/".concat(this.options.databaseName||"faas","/").concat(this.collectionName)};p([m(),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",Promise)],i.prototype,"end",null);return i}();export{w as Aggregate};
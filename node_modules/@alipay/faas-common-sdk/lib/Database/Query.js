"use strict";var __decorate=this&&this.__decorate||function(s,n,e,o){var r=arguments.length,t=r<3?n:o===null?o=Object.getOwnPropertyDescriptor(n,e):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")t=Reflect.decorate(s,n,e,o);else for(var u=s.length-1;u>=0;u--)if(a=s[u])t=(r<3?a(t):r>3?a(n,e,t):a(n,e))||t;return r>3&&t&&Object.defineProperty(n,e,t),t};var __metadata=this&&this.__metadata||function(s,n){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(s,n)};var __awaiter=this&&this.__awaiter||function(s,n,e,o){function r(t){return t instanceof e?t:new e(function(a){a(t)})}return new(e||(e=Promise))(function(t,a){function u(c){try{i(o.next(c))}catch(p){a(p)}}function l(c){try{i(o["throw"](c))}catch(p){a(p)}}function i(c){c.done?t(c.value):r(c.value).then(u,l)}i((o=o.apply(s,n||[])).next())})};var __generator=this&&this.__generator||function(s,n){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,r,t,a;return a={next:u(0),"throw":u(1),"return":u(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(i){return function(c){return l([i,c])}}function l(i){if(o)throw new TypeError("Generator is already executing.");while(a&&(a=0,i[0]&&(e=0)),e)try{if(o=1,r&&(t=i[0]&2?r["return"]:i[0]?r["throw"]||((t=r["return"])&&t.call(r),0):r.next)&&!(t=t.call(r,i[1])).done)return t;if(r=0,t)i=[i[0]&2,t.value];switch(i[0]){case 0:case 1:t=i;break;case 4:e.label++;return{value:i[1],done:false};case 5:e.label++;r=i[1];i=[0];continue;case 7:i=e.ops.pop();e.trys.pop();continue;default:if(!(t=e.trys,t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){e=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){e.label=i[1];break}if(i[0]===6&&e.label<t[1]){e.label=t[1];t=i;break}if(t&&e.label<t[2]){e.label=t[2];e.ops.push(i);break}if(t[2])e.ops.pop();e.trys.pop();continue}i=n.call(s,e)}catch(c){i=[6,c];r=0}finally{o=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.Query=void 0;var faas_db_builder_1=require("@alipay/faas-db-builder");var decorator_1=require("../decorator");var utils_1=require("../utils");var Query=function(){function s(n,e){this.collectionName=n;this.options=e;this.builder=new faas_db_builder_1.QueryBuilder(n)}s.prototype.limit=function(n){this.builder.limit(n);return this};s.prototype.skip=function(n){this.builder.skip(n);return this};s.prototype.where=function(n){this.builder.where(n);return this};s.prototype.projection=function(n){this.builder.projection(n);return this};s.prototype.field=function(n){this.builder.projection(n);return this};s.prototype.orderBy=function(n,e){this.builder.orderBy(n,e);return this};s.prototype.updateAndReturn=function(n){return __awaiter(this,void 0,void 0,function(){var e,o,r,t,a;return __generator(this,function(u){switch(u.label){case 0:e="POST";o="".concat(this.getCollectionPath(),"?findOneAndUpdate");r=this.builder.updateAndReturn(n).options;return[4,this.options.httpclient.request({method:e,path:o,data:r})];case 1:t=u.sent();a=utils_1.ResponseUtil.handleResponse(t);return[2,{updated:a?1:0,doc:a}]}})})};s.prototype.update=function(n){return __awaiter(this,void 0,void 0,function(){var e,o,r,t;return __generator(this,function(a){switch(a.label){case 0:e="POST";o="".concat(this.getCollectionPath(),"?update");r=this.builder.update(n).options;return[4,this.options.httpclient.request({method:e,path:o,data:r})];case 1:t=a.sent();return[2,utils_1.ResponseUtil.handleResponse(t)]}})})};s.prototype.set=function(n){return __awaiter(this,void 0,void 0,function(){var e,o,r,t;return __generator(this,function(a){switch(a.label){case 0:e="POST";o="".concat(this.getCollectionPath(),"?replace");r=this.builder.set(n).options;return[4,this.options.httpclient.request({method:e,path:o,data:r})];case 1:t=a.sent();return[2,utils_1.ResponseUtil.handleResponse(t)]}})})};s.prototype.remove=function(){return __awaiter(this,void 0,void 0,function(){var n,e,o,r;return __generator(this,function(t){switch(t.label){case 0:n="POST";e="".concat(this.getCollectionPath(),"?delete");o=this.builder.remove().options;return[4,this.options.httpclient.request({method:n,path:e,data:o})];case 1:r=t.sent();return[2,utils_1.ResponseUtil.handleResponse(r)]}})})};s.prototype.get=function(){return __awaiter(this,void 0,void 0,function(){var n,e,o,r;return __generator(this,function(t){switch(t.label){case 0:n="POST";e="".concat(this.getCollectionPath(),"?query");o=this.builder.get().options;return[4,this.options.httpclient.request({method:n,path:e,data:o})];case 1:r=t.sent();return[2,utils_1.ResponseUtil.handleResponse(r)]}})})};s.prototype.count=function(){return __awaiter(this,void 0,void 0,function(){var n,e,o,r,t;return __generator(this,function(a){switch(a.label){case 0:n="POST";e="".concat(this.getCollectionPath(),"?count");o=this.builder.count().options;return[4,this.options.httpclient.request({method:n,path:e,data:o})];case 1:r=a.sent();t=utils_1.ResponseUtil.handleResponse(r);return[2,{total:t.count}]}})})};s.prototype.getCollectionPath=function(){return"/".concat(this.options.databaseName||"faas","/").concat(this.collectionName)};__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],s.prototype,"updateAndReturn",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],s.prototype,"update",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Promise)],s.prototype,"set",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],s.prototype,"remove",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],s.prototype,"get",null);__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],s.prototype,"count",null);return s}();exports.Query=Query;
"use strict";var __decorate=this&&this.__decorate||function(i,e,r,u){var o=arguments.length,t=o<3?e:u===null?u=Object.getOwnPropertyDescriptor(e,r):u,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")t=Reflect.decorate(i,e,r,u);else for(var c=i.length-1;c>=0;c--)if(a=i[c])t=(o<3?a(t):o>3?a(e,r,t):a(e,r))||t;return o>3&&t&&Object.defineProperty(e,r,t),t};var __metadata=this&&this.__metadata||function(i,e){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(i,e)};var __awaiter=this&&this.__awaiter||function(i,e,r,u){function o(t){return t instanceof r?t:new r(function(a){a(t)})}return new(r||(r=Promise))(function(t,a){function c(s){try{n(u.next(s))}catch(f){a(f)}}function l(s){try{n(u["throw"](s))}catch(f){a(f)}}function n(s){s.done?t(s.value):o(s.value).then(c,l)}n((u=u.apply(i,e||[])).next())})};var __generator=this&&this.__generator||function(i,e){var r={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},u,o,t,a;return a={next:c(0),"throw":c(1),"return":c(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(n){return function(s){return l([n,s])}}function l(n){if(u)throw new TypeError("Generator is already executing.");while(a&&(a=0,n[0]&&(r=0)),r)try{if(u=1,o&&(t=n[0]&2?o["return"]:n[0]?o["throw"]||((t=o["return"])&&t.call(o),0):o.next)&&!(t=t.call(o,n[1])).done)return t;if(o=0,t)n=[n[0]&2,t.value];switch(n[0]){case 0:case 1:t=n;break;case 4:r.label++;return{value:n[1],done:false};case 5:r.label++;o=n[1];n=[0];continue;case 7:n=r.ops.pop();r.trys.pop();continue;default:if(!(t=r.trys,t=t.length>0&&t[t.length-1])&&(n[0]===6||n[0]===2)){r=0;continue}if(n[0]===3&&(!t||n[1]>t[0]&&n[1]<t[3])){r.label=n[1];break}if(n[0]===6&&r.label<t[1]){r.label=t[1];t=n;break}if(t&&r.label<t[2]){r.label=t[2];r.ops.push(n);break}if(t[2])r.ops.pop();r.trys.pop();continue}n=e.call(i,r)}catch(s){n=[6,s];o=0}finally{u=t=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.Aggregate=void 0;var faas_db_builder_1=require("@alipay/faas-db-builder");var decorator_1=require("../decorator");var utils_1=require("../utils");var Aggregate=function(){function i(e,r){this.collectionName=e;this.options=r;this.builder=new faas_db_builder_1.AggregateBuilder(e)}i.prototype.addFields=function(e){this.builder.addFields(e);return this};i.prototype.count=function(e){this.builder.count(e);return this};i.prototype.match=function(e){this.builder.match(e);return this};i.prototype.group=function(e){this.builder.group(e);return this};i.prototype.sample=function(e){this.builder.sample(e);return this};i.prototype.lookup=function(e){this.builder.lookup(e);return this};i.prototype.project=function(e){this.builder.project(e);return this};i.prototype.replaceRoot=function(e){this.builder.replaceRoot(e);return this};i.prototype.sort=function(e){this.builder.sort(e);return this};i.prototype.limit=function(e){this.builder.limit(e);return this};i.prototype.skip=function(e){this.builder.skip(e);return this};i.prototype.unwind=function(e){this.builder.unwind(e);return this};i.prototype.end=function(){return __awaiter(this,void 0,void 0,function(){var e,r,u,o;return __generator(this,function(t){switch(t.label){case 0:e=this.builder.end().options;r="POST";u="".concat(this.getCollectionPath(),"?aggregate");return[4,this.options.httpclient.request({method:r,path:u,data:e})];case 1:o=t.sent();return[2,utils_1.ResponseUtil.handleResponse(o)]}})})};i.prototype.getCollectionPath=function(){return"/".concat(this.options.databaseName||"faas","/").concat(this.collectionName)};__decorate([(0,decorator_1.WrapCallback)(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],i.prototype,"end",null);return i}();exports.Aggregate=Aggregate;